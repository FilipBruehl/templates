apply plugin: 'java'

jar {
  dependsOn 'createArchives'
  from(fileTree("$buildDir/archives")) {  
      into "META-INF/templates" 
  }
}

task createArchives(type: Tar) {
  file('.').eachDirMatch(~/^(java)$/) { sub ->
    dependsOn tasks.create("${name}_${sub.name}", Tar) {
      from sub
      archiveBaseName = sub.name
      destinationDirectory = file("$buildDir/archives")
    }
  }
}